LATEXMK ?= latexmk
PANDOC ?= pandoc

STY_FILES := $(wildcard *.sty)
TIKZ_IMAGES := $(wildcard *.tikz.tex)

TEX_SOURCES := $(wildcard slides.tex)
PDF_FROM_TEX := $(TEX_SOURCES:%.tex=%.pdf)

RST_SOURCES := $(wildcard *.rst)
PDF_FROM_RST := $(RST_SOURCES:%.rst=%.pdf)

TEMPLATE = grehack2019.beamer
VARIABLES = -V 'theme:ioonag' -V 'section-titles:' -V 'toc:'
#VARIABLES += -V 'geometry:paperwidth=160mm' -V 'geometry:paperheight=120mm'
#VARIABLES += -V 'babel-lang:french' -V 'lang:fr-FR'
PANDOCFLAGS = --slide-level=2 -s --toc --template=$(TEMPLATE) $(VARIABLES) -t beamer --pdf-engine=xelatex

all: $(PDF_FROM_TEX) $(PDF_FROM_RST)

%.pdf: %.rst $(TEMPLATE) $(STY_FILES) $(TIKZ_IMAGES)
	$(PANDOC) $(PANDOCFLAGS) -o $@ $<

# Run "make slides-rst.rst.tex" to view the LaTeX-beamer file generated by pandoc
%.rst.tex: %.rst
	$(PANDOC) $(PANDOCFLAGS) -o $@ $<

%.pdf: %.tex $(STY_FILES) $(TIKZ_IMAGES)
	$(LATEXMK) -pdf $< < /dev/null

clean:
	$(RM) $(PDF_FROM_TEX) $(PDF_FROM_RST) ./*.rst.tex

.PHONY: all clean
